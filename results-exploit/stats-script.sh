#! /bin/sh

if [ $# -lt 1 ] 
then
  echo 'not enough arg : ./stats-script.sh [files prefix]'
  exit 1
fi

# sed -Ei 's/^\[//' tmp.json
# sed -Ei 's/\]$/,/' tmp.json

outputfile='output/merged-logs.json'

echo "BEGIN\n"

# On prend le premier fichier json, on remplace l'accolade fermante par une virgule
cat "$1" > tmp.json
sed -Ei 's/\]$/,/' tmp.json
cat tmp.json > $outputfile
shift

# On boucle sur le reste des fichier
for file in $*
do
  sed -Ei 's/^\[//' tmp.json
  sed -Ei 's/\]$/,/' tmp.json
  cat tmp.json >> $outputfile
done

# On remplace la derniere virgule du fichier par une accolade fermante
sed -Ei 's/,$/\]/' $outputfile
rm tmp.json
echo 'Merge complete !'

